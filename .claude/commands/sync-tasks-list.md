# sync-tasks-list.md

# タスクリスト同期（RDD準拠・差分PR版）

## タスク全容: $ARGUMENTS
`$ARGUMENTS = TASK-LIST のパス（例: ai-task/task-list.md）`

引数で渡された既存の**タスクリスト**を、**現在のコードベースの事実**と **doc/rdd.md（要件・非機能・制約）** に基づいて再同期します。  
すでに**実行済み**のタスクは「完了扱い＋実績追記」、**未実行スプリントのみ**内容を**修正・再配列**し、**差分のみ**を提示します（ここで停止）。  
※このコマンドは「**タスクリスト → 1スプリント実行 → レビュー/フィードバック → 変更**」のループで、**変更フェーズ**にのみ使用します。

---

## RDD遵守・ガードレール
- **唯一の正**: `doc/rdd.md`（目標/非目標、対象ドメイン、技術スタック、非機能要件、制約）
- **禁止**: RDDに未記載の新規スタック採用／完了済みスプリント本文の書き換え
- **許可**: 完了済みスプリントへの**“実績” セクション追記**（根拠リンクのみ）
- **逸脱が必要な場合**: 変更要求（ADR-lite）を**別ファイル**で起案し、承認後に反映

---

## 調査プロセス
1. **入力読取**  
   - `TASK-LIST`（見出し/タスクID/チェックボックス/所要/依存/DoD/参照）を厳密にパース  
   - `doc/rdd.md` を読み、DoD・対象外・制約を抽出（章節を参照可能に）
2. **コードベース分析**  
   - Git履歴（Conventional Commits推奨）/変更ファイル/Storybook・テスト・CI結果を照合  
   - タスクごとに **{done｜partial｜not_started}** を判定し、**根拠**（コミット/PR/ファイル）を添付
3. **RDD整合チェック**  
   - RDD改訂点とタスク内容の乖離を検出（非機能・制約違反、スタック逸脱）
4. **スプリント対象の限定**  
   - **未実行スプリントのみ**修正（過去スプリントは凍結）

---

## 同期の指針（編集ポリシー）
- **done**: チェック済みに変更し、**“実績”**（コミット/PR/スクリーンショット/CI）リンクを追記。本文は**不変**  
- **partial**: タスクを**分割**（完了部/未完部）。DoD未達点を明記し、依存・見積を更新  
- **not_started**: `doc/rdd.md`の最新版を根拠に**再設計**（前提/依存/成果物/検証手順/見積/担当）  
- **順序最適化**: 依存 → リスク高 → 価値高 の順に並べ替え  
- **フォーマット厳守**: 既存の書式（見出し、チェック、ID、参照、所要、依存）を崩さない  
- **出力は差分のみ**: 変更点だけを提示し、**ここで停止**

---

## 出力フォーマット例（差分提示・抜粋）
> 既存の `doc/tasks.md` に対する**パッチ表示**（差分）を出力します。

    ## S-03: Skeleton → Happy Path（施設一覧）
    - [ ] T-031 Skeleton: コンポーネント雛形生成（3h）
    + [x] T-031 Skeleton: コンポーネント雛形生成（実績: 3.5h）
    +   実績: PR #128, commit abc123, Storybook snapshot green
        DoD: StorybookでFigma一致、tokens外値なし
        参照: doc/rdd.md §2.1, design/design-tokens.json
        依存: design/components.json
    ...
    - [ ] T-032 Happy Path: 一覧API仮接続（5h）
    + [ ] T-032a APIスタブ接続とUI結線（3h）
    +   DoD: スモーク緑 / ローディング表示 / 200系正常系
    +   依存: T-031
    + [ ] T-032b フィルタ（種別/年齢/区分）実装（3h）
    +   DoD: Storybook操作で各フィルタが反映 / 主要幅で崩れなし
    +   依存: T-032a

**変更理由サマリ（例）**  
- RDD差分: `doc/rdd.md §2.3` の非機能（**主要幅で崩れなし**）が未充足 → 032bへ分割  
- 証跡: commit `abc123`（Skeleton完了）/ CI green / Storybook snapshot 一致  
- 未達DoD: フィルタの主要幅検証・ローディング可視化が未達

---

## Sprint出力テンプレ（統一書式）
### Sprint {ID}: {スプリント名}
- **目的**: …
- **スコープ**: …
- **RDD参照**: `doc/rdd.md §{...}`

#### タスク一覧
- [ ] {TASK-ID}: 概要（想定:{xh}）
  - ファイル: …
  - 検証ゲート:  
        pnpm lint && pnpm type-check && pnpm test  
        Storybook snapshot / `npm run smoke`
  - 参照: `doc/rdd.md §...`, `path/to/code`, PR/commit
  - 依存: …
  - 決定理由: …（RDD差分/証跡/リスク）

> **状態タグ（任意）**: ✅done / ⧗partial / ☐not_started

---

## 実行と停止（このコマンドの作法）
- **常にドライラン（dry）**：ファイルは**書き換えず**、**差分のみ**を提示  
- ユーザーが確認し、適用したい場合は**別の適用コマンド**（例: `tasks-apply-patch`）で反映  
- このコマンドは**ここで停止**し、適用は次段に委ねる

---

## 保存先
- 変更提案（差分）は**標準出力**  
- 追加の詳細ログ（任意）: `ai-task/logs/rdd-sync-tasks-{timestamp}.md`（根拠リンク・判定経緯）

---

## 品質チェックリスト
- `doc/rdd.md` の**目標/非目標/DoD/制約**と**完全整合**  
- 完了済みスプリント本文は**不変**（“実績”追記のみ）  
- **未実行スプリントのみ**修正・再配列  
- 各タスクに**検証ゲート**（自動実行可能コマンド/Storybook/CI）  
- **決定理由**が1行で明記（RDD差分・証跡・リスク）  
- tokens/variants外の**魔法の数値**追加なし  
- 出力は**差分のみ**で明確（適用は別段）

---

## 自己評価
成功自信度 (1-10) ＋ 一言理由  
例）**9/10** — 既存フォーマット厳守＋RDD整合で差分限定、誤破壊リスクが低いから
