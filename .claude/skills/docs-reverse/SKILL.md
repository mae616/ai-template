---
user-invocable: true
description: "[ドキュメント] リバースエンジニアリングによるドキュメント作成（俯瞰/引き継ぎ用）"
---

# [ドキュメント] リバースエンジニアリングによるドキュメント作成（俯瞰/引き継ぎ用）

## 入力: `$ARGUMENTS`（解析対象ディレクトリの相対パスを**半角スペース区切り**で複数可）
例:
    src backend/services packages/auth

---

## 🎯 目的
- AIが作ったアプリを、人間が **俯瞰/詳細**で理解できるドキュメントを生成/更新する
- 新しい人が既存アプリを理解でき、開発者が「AIが何をしたか/どう作ったか」を追える状態にする
- **SSOT（Single Source of Truth）** を守りつつ、生成物を `doc/_generated/` に集約して迷子を防止する

---

## 前提/参照（SSOT）
- **SSOT**: `doc/input/rdd.md`, `doc/Architecture.md`, `doc/input/design/*`（存在すれば）
- **生成物の出力先**: `doc/_generated/`（上書き更新してよい。履歴はGitで追跡）

---

## 実行仕様（概要）
1. **コード解析（対象: `$ARGUMENTS` で与えた各ディレクトリ）**
   - 主要エクスポート/公開API、データモデル、入出力、依存関係、例外/エラーハンドリング、I/O境界を抽出
   - 関数/クラスの **Docコメント（JSDoc/Docstring 等）を抽出**し、文書へ反映
   - 既存テストとカバレッジ対象を検出（あればリンク）

2. **SSOT整合チェック**
   - `doc/input/rdd.md`, `doc/Architecture.md`（＋デザインがあれば `doc/input/design/*`）と差分比較
   - 不一致/未記載は **差分提案** として記録
   - 技術スタック逸脱が必要な場合は **変更要求（ADR-lite）** を起票（テンプレは下記）

3. **逆生成する文書**（「出力ドキュメント」参照）を**最小差分で更新**
   - 重複は避け、**SSOTへ集約＋相互参照**
   - 図は **Mermaid を優先**し、必要なら **ASCIIフォールバック**も併記する（描画できない環境への備え）

4. **品質チェック & 自己評価** を末尾に付す

---

## 変更要求（ADR-lite）テンプレ（必要時のみ）
    Change Request: {タイトル}
    - RDD参照: doc/input/rdd.md §{該当セクション}
    - 現状の制約: {なぜRDD準拠だと難しいか}
    - 提案差分: {スタック/設計の変更内容（最小）}
    - 影響: {テスト/運用/セキュリティ/コスト}
    - 代替案: {検討したが採用しない案}
    - 戻し方: {ロールバック手順}
    - 推奨: 承認/却下の判断材料

---

## 解析の詳細ステップ（AIがやること）
1. **エントリポイント/公開境界の特定**
   - CLI/HTTPハンドラ/RPC/イベント/ジョブ等の起点を列挙
   - 入力（DTO/型）と出力（レスポンス/副作用）を抽出
2. **ドメイン/データモデルの抽出**
   - エンティティ/値オブジェクト/リポジトリ/サービスの依存関係
   - バリデーション/整合条件/ビジネスルール
3. **フローの抽出**
   - 代表ユースケースごとに処理シーケンスをテキストで起こす
   - 例外/リトライ/タイムアウト/トランザクション境界を明示
4. **API定義の逆生成**
   - ルート/メソッド/パラメータ/スキーマ/認証/エラーコード
   - 最小のリクエスト・レスポンス例を付与
5. **Docコメントの反映**
   - 関数/クラスのDocを対応章に抜粋（不足は TODO として記載）
6. **整合性の判定**
   - RDD/Architecture（＋Designがあれば）との齟齬を列挙
   - 「記述不足」「実装が先行」「設計が古い」を分類
7. **ドキュメント生成/更新**
   - 以降「出力ドキュメント」のテンプレ構造で最小差分更新

---

## 出力ドキュメント（最小差分更新）
> すべて **Markdown**。図は **Mermaid（＋必要ならASCIIフォールバック）**。重複は避け**相互参照**で結ぶ。

### 1) SSOTへの反映（原則: 提案まで）
- `doc/input/rdd.md` / `doc/Architecture.md` は人間が育てるSSOT。
- 変更が必要そうな場合は **差分提案** として `doc/_generated/ssot_diff.md` に記録し、勝手に上書きしない。

### 2) `doc/_generated/index.md`（入口）
- 俯瞰/詳細へのリンク集（読む順番を含む）

### 3) `doc/_generated/overview.md`（俯瞰）
- システム概要、主要境界、依存方向、データフローの要約

### 4) `doc/_generated/diagrams/`（図）
- `system_overview.md`（Mermaid + ASCIIフォールバック）
- `data_flow.md`（Mermaid + ASCIIフォールバック）
- `class_overview.md`（必要なら）

### 5) `doc/_generated/api.md`（APIがある場合のみ）
- エンドポイント: メソッド/パス/認証/スキーマ/例/エラー（最小）

### 6) `doc/_generated/modules/`（詳細）
- 主要モジュールの責務/入出力/例外/依存（必要な範囲だけ）

---

## 品質チェックリスト
- [ ] SSOT整合
- [ ] デザイン無し検出でスキップ
- [ ] Docコメント反映
- [ ] UMLはASCII
- [ ] API仕様に例とエラー方針
- [ ] テストケースは正常/境界/異常
- [ ] トレードオフ/判断理由あり
- [ ] 重複なし、相互参照

---

## 自己評価（1–10）
- 自信度: X/10
- 根拠（1行）: …
- 次の改善（2–3件）: …

---

### 備考
- **Docコメント不足**の箇所は TODO として明示。次スプリントで補完。
- 技術スタック逸脱が必要な場合は **変更要求（ADR-lite）** を同時出力し、**承認が出るまで実装反映は行わない**。
