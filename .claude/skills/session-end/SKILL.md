---
user-invocable: true
description: "[セッション] 終了時の進捗サマリー・再開用プロンプト生成"
---

# [セッション] セッション終了

## 入力: $ARGUMENTS
- 省略可（現在のTaskListから自動取得）

---

## 🎯 目的
- **セッション終了時に進捗を保存**して、次回スムーズに再開できるようにする
- 未完了タスクと再開用プロンプトを生成する
- 中断しても何も失われない状態を作る

---

## 実行手順

### 1. 現在の状態確認

**TaskListの確認:**
```
TaskList を実行して現在のタスク状態を取得
```

**Git状態の確認:**
```bash
git status
git log --oneline -5
```

---

### 2. 進捗サマリー生成

```markdown
## 📋 セッション終了サマリー

### 完了したこと
- ✅ {completed_task_1}
- ✅ {completed_task_2}

### 未完了（次回継続）
- 🔄 {in_progress_task} - {進捗状況}
- ⏸️ {pending_task}

### 成果物
| 種別 | 内容 |
|------|------|
| コミット | {commit_count}件 ({commit_hashes}) |
| 新規ファイル | {new_files} |
| 変更ファイル | {modified_files} |

### 未コミットの変更
{git status の結果、あれば}
```

---

### 3. 再開用プロンプト生成

```markdown
## 🔄 次回再開用

### 再開プロンプト（コピー用）
> {task_description}
> 前回の進捗: {progress_summary}
> 残タスク: {remaining_tasks}
> 続きから再開してください。

### コンテキスト
- **ブランチ**: {current_branch}
- **最後のコミット**: {last_commit_hash} - {last_commit_message}
- **TaskList ID**: {task_list_id}（あれば）
```

---

### 4. 未コミット変更の処理提案

未コミットの変更がある場合：

```markdown
## ⚠️ 未コミットの変更あり

以下の選択肢があります:

1. **コミットする** - 変更を保存してセッション終了
2. **スタッシュする** - `git stash` で一時保存
3. **そのまま終了** - 変更は残るが、明示的な記録なし

どうしますか？
```

---

### 5. 再開用コンテキストをファイルに保存

```bash
# .claude/session-context.md に保存
cat > .claude/session-context.md << 'EOF'
# セッションコンテキスト

## 前回の作業
- **日時**: {timestamp}
- **ブランチ**: {current_branch}
- **最後のコミット**: {last_commit_hash} - {last_commit_message}

## 進捗
- 完了: {completed_tasks}
- 未完了: {remaining_tasks}

## 再開用プロンプト
{resume_prompt}

## 次にやること
{next_actions}
EOF
```

> 💡 次のセッション開始時に自動で読み込まれる

---

### 6. 終了確認

```markdown
---

## ✅ セッション終了

**進捗**: {completed}/{total} タスク完了
**コンテキスト保存**: .claude/session-context.md
**次回再開**: 自動で読み込まれます

お疲れ様でした！

---
```

---

## 出力例

```markdown
## 📋 セッション終了サマリー

### 完了したこと
- ✅ PR #123 のレビューコメント対応（3件中2件）
- ✅ コミット2件作成

### 未完了（次回継続）
- 🔄 コメント#3の対応 - コード確認中
- ⏸️ git push

### 成果物
| 種別 | 内容 |
|------|------|
| コミット | 2件 (abc1234, def5678) |
| 変更ファイル | src/foo.ts, src/bar.ts |

---

## 🔄 次回再開用

### 再開プロンプト（コピー用）
> PR #123 のレビュー対応を再開
> 前回: コメント#1,#2 対応済み、#3 が残り
> `/pr-respond 123` で #3 から再開してください

### コンテキスト
- **ブランチ**: fix/review-123
- **最後のコミット**: def5678 - fix: nullチェック追加

---

## ✅ セッション終了

**進捗**: 2/3 タスク完了
**次回再開**: 上記プロンプトをコピーして使用

お疲れ様でした！
```

---

## 連携スキル

- `/session-start` - セッション開始時のゴール・完了条件明確化
- `/pr-respond` - PRレビューコメント対応
- `/task-run` - Issueベースのタスク実行

---

## 注意事項

- **未コミットの変更は必ず確認**してから終了する
- 再開プロンプトは**具体的に**（曖昧だと次回コンテキストが失われる）
- TaskListがある場合は**タスク状態も更新**してから終了

---

## 自己評価
- **成功自信度**: (1-10)
- **一言理由**: {短く理由を記載}
