# AI運用ガイドライン（詳細）

このドキュメントは `CLAUDE.md` から切り出した**運用上の細則**をまとめたものです。  
`CLAUDE.md` は「憲法（不変の核）」として軽量に保ち、こちらは必要に応じて参照します。

## 1. サンプルコード運用（切り分け・最小検証）
- **目的**: 原因切り分け・再現性確認・最小検証のためだけに作成する（プロダクションへ直接流用しない）。
- **配置**: プロジェクトの実行系から参照・実行可能な適切な場所に `samples/` を切る（例：`server/samples/`、`packages/foo/samples/` など）。本番ビルド・配布からは除外する。
- **命名**: `sample_{short-purpose}.{ext}`（例: `sample_repo_auth.ts`）。
- **可視化**: 先頭コメントに「一時利用・削除可」を明記する。
- **機密**: 実鍵・個人情報・API Key・本番エンドポイント禁止（モック/ダミー値）。
- **ビルド/CI・計測除外**: ビルド/テスト/カバレッジから `samples` を除外（設定で ignore）。必要に応じて `/* istanbul ignore file */` 等を併用。
- **後片付け**: 解決後は同PRで削除、または削除用PRを用意する。

## 2. 依存（ライブラリ）評価の補助基準
`CLAUDE.md` の原則（デファクト/更新頻度/ライセンス健全）に加えて、判断が割れる場合の補助軸です。

- **評価観点**: 直近リリース日、Issue応答、ドキュメント質、DL数/週、互換性、代替案の有無
- **注意**: 数値条件（⭐や更新期間など）はプロジェクト事情で例外が出るため「絶対条件」ではなく、**判断材料**として扱う。

### 2.1 依存のダウングレード（最終手段）
フレームワーク/ライブラリのダウングレードは、短期的に問題が解決しても **脆弱性・互換性・将来保守**のリスクが上がりやすい。

- **原則**: ダウングレードは最終手段。先に以下を検討する。
  - アップグレード（同系統のパッチ/マイナー）で解消できないか
  - 設定変更・回避策・feature flagで切れるか
  - 代替ライブラリ/実装への置換
  - 依存衝突の解消（lockfile整理、解決戦略の見直し）
- **実施条件**: どうしてもダウングレードが必要な場合は、必ずユーザーに事前確認する。
  - 理由（何が壊れていて、なぜ他案がダメか）
  - 影響（セキュリティ、互換性、運用、将来のアップグレード計画）
  - ロールバック手順（戻せることの担保）
  - （可能なら）代替案2つ以上の比較

## 3. TDD/スクラムの“毎出力フッタ”について
TDD（RED→GREEN→REFACTOR）と段階的な進め方は強い原則ですが、**毎回答に定型フッタを強制**すると情報量が増えやすい場合があります。

- **推奨運用**: 重要な作業（実装/設計変更/バグ対応/調査）では、`commands/` や該当skill（例: `developer-specialist`）の出力フォーマットに従い、必要な範囲でRED/GREEN/REFACTORを明示する。

## 4. ADR-lite（変更要求）のミニテンプレ
RDD逸脱や設計の大きな変更が必要なとき、合意形成のために使います。

- Context: 何が前提で、何が問題か
- Decision: 何を決めるか（選択肢A/Bと比較）
- Consequences: 影響（メリット/デメリット/運用/コスト）
- Alternatives: 採用しない案と理由

## 5. 情報源・引用（出典）ポリシー（詳細）
`CLAUDE.md` の「基本原則（でたらめな引用/推測の断言をしない）」を、実務で迷わない粒度に落としたものです。

- **公式最優先**：ベンダー公式ドキュメント、公式GitHub（issue/PR/ディスカッション）を最上位の根拠とする
- **英語圏優先**：Stack Overflow（英語）の重複解決事例を重視する
- **二次情報（Zenn/Qiitaなど）**：
  - ①複数の独立した裏付けが取れる
  - ②専門知見として現実的・合理的であると判断できる
  の両方を満たす場合に限り、**補助的に**採用する（採用理由を明記）
- **バージョン整合**：自プロジェクトのフレームワーク/ランタイム/依存関係のバージョンと整合が取れているか確認する
- **セキュリティ**：秘匿情報の露出禁止。提案は最小権限の原則を尊重する
- **実運用考慮**：ロールバック容易性・影響範囲・メンテナンス性も評価軸に含める


